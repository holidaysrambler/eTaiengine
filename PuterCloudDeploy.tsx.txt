"use client"

import { useState } from "react"
import { motion } from "framer-motion"
import { Cloud, ExternalLink } from "lucide-react"

interface PuterCloudDeployProps {
  code: string
}

export default function PuterCloudDeploy({ code }: PuterCloudDeployProps) {
  const [isDeploying, setIsDeploying] = useState(false)
  const [deployUrl, setDeployUrl] = useState("")
  const [error, setError] = useState("")

  const handleDeploy = async () => {
    setIsDeploying(true)
    setError("")
    try {
      if (typeof window !== "undefined" && (window as any).puter) {
        const puter = (window as any).puter

        const htmlContent = `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generated UI - eT's AI Builder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { 
      margin: 0; 
      padding: 16px;
      background: linear-gradient(to bottom right, #1a1a2e, #0a0a0f);
      min-height: 100vh;
      color: white;
    }
  </style>
</head>
<body>
  ${code}
</body>
</html>
        `

        const fileName = `generated-ui-${Date.now()}.html`
        await puter.fs.write(fileName, htmlContent)

        const appName = `etai-${Date.now()}`
        const result = await puter.hosting.create(appName, {
          indexDocument: fileName,
        })

        setDeployUrl(result.url)
      } else {
        setError("Puter SDK not loaded. Please refresh the page.")
      }
    } catch (error) {
      console.error("[v0] Error deploying to Puter:", error)
      setError("Failed to deploy. Please try again.")
    } finally {
      setIsDeploying(false)
    }
  }

  return (
    <div className="mt-8 flex flex-col gap-4">
      <motion.button
        onClick={handleDeploy}
        disabled={isDeploying || !code}
        className="bg-gradient-to-r from-purple-600 to-purple-700 text-white px-8 py-4 rounded-xl text-xl font-bold button-glow disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
        whileHover={{ scale: 1.03 }}
        whileTap={{ scale: 0.98 }}
      >
        <Cloud className="w-5 h-5" />
        {isDeploying ? "Deploying to Puter Cloud..." : "Deploy to Puter Cloud"}
      </motion.button>

      {error && (
        <motion.div
          initial={{ opacity: 0, y: -10 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-red-900/30 border border-red-500 rounded-xl p-4"
        >
          <p className="text-red-400 font-inter">{error}</p>
        </motion.div>
      )}

      {deployUrl && (
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          className="bg-green-900/30 border border-green-500 rounded-xl p-4"
        >
          <p className="text-green-400 font-inter font-semibold mb-2 flex items-center gap-2">
            âœ¨ Successfully deployed to Puter Cloud!
          </p>
          <a
            href={deployUrl}
            target="_blank"
            rel="noopener noreferrer"
            className="text-purple-400 hover:text-purple-300 underline break-all flex items-center gap-2"
          >
            {deployUrl}
            <ExternalLink className="w-4 h-4 flex-shrink-0" />
          </a>
        </motion.div>
      )}

      <p className="text-gray-400 text-sm font-inter text-center">
        Deploy your generated UI to Puter Cloud - a free, open-source hosting platform
      </p>
    </div>
  )
}
